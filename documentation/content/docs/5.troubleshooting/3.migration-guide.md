---
title: Migration Guide - Environment Variables
description: Guide for migrating from environments to environment variables system
navigation:
  title: Migration Guide
---

# Migration Guide: Environment Variables

TestFlowKit has replaced the `environments` configuration system with a more flexible **environment variables** system. This guide helps you migrate your existing configurations.

## What Changed?

### Deprecated (Old System)

```yaml
active_environment: "local"

environments:
  local:
    frontend_base_url: "http://localhost:3000"
    rest_api_base_url: "http://localhost:3001"
    graphql_endpoint: "http://localhost:3001/graphql"
  
  staging:
    frontend_base_url: "https://staging.example.com"
    rest_api_base_url: "https://api-staging.example.com"
    graphql_endpoint: "https://api-staging.example.com/graphql"
```

**CLI:**
```bash
tkit run --env staging
```

### New System (Environment Variables)

```yaml
# config.yml
settings:
  env_file: ".env.local.yml"  # Optional: default env file

env:
  frontend_base_url: "http://localhost:3000"
  rest_api_base_url: "http://localhost:3001"
  graphql_endpoint: "http://localhost:3001/graphql"
```

**External files:**
```yaml
# .env.staging.yml
frontend_base_url: "https://staging.example.com"
rest_api_base_url: "https://api-staging.example.com"
graphql_endpoint: "https://api-staging.example.com/graphql"
```

**CLI:**
```bash
tkit run --env-file .env.staging.yml
```

## Migration Steps

### Step 1: Update Configuration Structure

**Before:**
```yaml
active_environment: "local"

settings:
  concurrency: 1
  gherkin_location: "./features"

environments:
  local:
    frontend_base_url: "http://localhost:3000"
    rest_api_base_url: "http://localhost:3001"
```

**After:**
```yaml
settings:
  concurrency: 1
  gherkin_location: "./features"
  env_file: ".env.local.yml"  # Optional

env:
  frontend_base_url: "http://localhost:3000"
  rest_api_base_url: "http://localhost:3001"
```

### Step 2: Create Environment-Specific Files (Optional)

For better organization, create separate files for each environment:

**.env.local.yml:**
```yaml
frontend_base_url: "http://localhost:3000"
rest_api_base_url: "http://localhost:3001"
api_key: "local-dev-key"
```

**.env.staging.yml:**
```yaml
frontend_base_url: "https://staging.example.com"
rest_api_base_url: "https://api-staging.example.com"
api_key: "staging-api-key"
```

**.env.production.yml:**
```yaml
frontend_base_url: "https://example.com"
rest_api_base_url: "https://api.example.com"
```

### Step 3: Update CLI Commands

**Before:**
```bash
tkit run --env staging
tkit run --env production
```

**After:**
```bash
tkit run --env-file .env.staging.yml
tkit run --env-file .env.production.yml
```

### Step 4: Update Gherkin Files (If Using Custom URLs)

If you have Gherkin steps that reference environment-specific values, you can now use environment variables:

**Before:**
```gherkin
# No direct access to environment values
Given the user goes to the "home" page
```

**After:**
```gherkin
# Can now use environment variables directly
Given the user goes to "{{ env.frontend_base_url }}"
And I set the header "Authorization" to "Bearer {{ env.api_key }}"
```

## Benefits of the New System

### 1. More Flexible

```yaml
# Group related variables
env:
  # Frontend
  frontend_base_url: "http://localhost:3000"
  
  # API
  api:
    base_url: "http://localhost:3001"
    key: "dev-key"
    timeout: "30s"
  
  # Database
  database:
    host: "localhost"
    port: "5432"
    name: "testdb"
```

Access nested variables with dot notation:
```gherkin
When I connect to "{{ env.database.host }}:{{ env.database.port }}"
```

### 2. Use Variables in Config

```yaml
backend:
  default_headers:
    Authorization: "Bearer {{ env.api.key }}"
    X-Client-ID: "{{ env.client_id }}"
```

### 3. Priority System

Multiple sources with clear priority:
1. CLI `--env-file` (highest)
2. Config `settings.env_file`
3. Inline `env` block (lowest)

### 4. Better CI/CD Integration

```bash
# Different environments in CI
tkit run --env-file .env.ci.yml

# Production with secrets
export API_KEY="secret-key"
tkit run --env-file .env.production.yml
```

## Reserved Variable Names

These variables have special meaning for backward compatibility:

- `env.frontend_base_url` - Base URL for frontend tests
- `env.rest_api_base_url` - Base URL for REST API requests  
- `env.graphql_endpoint` - Endpoint for GraphQL operations

## Troubleshooting

### Validation Errors

When running `tkit validate`, TestFlowKit now checks for undefined environment variables:

```bash
$ tkit validate
⚠️  The following environment variables are referenced but not defined:
  - env.api_key
  - env.database.host

Define these variables in:
  1. config.yml under 'env:' block, or
  2. A separate YAML file referenced by 'settings.env_file' or --env-file
```

**Solution:** Add the missing variables to your config or env file.

### Migration Checklist

- [ ] Remove `active_environment` from config.yml
- [ ] Remove `environments:` block from config.yml
- [ ] Add `env:` block with required variables
- [ ] Create environment-specific `.env.*.yml` files (optional)
- [ ] Update CI/CD scripts to use `--env-file` instead of `--env`
- [ ] Run `tkit validate` to check for undefined variables
- [ ] Test with different environment files

## Need Help?

- [Configuration Guide](/docs/configuration)
- [Variables Documentation](/docs/features/variables)
- [GitHub Issues](https://github.com/TestFlowKit/testflowkit/issues)
